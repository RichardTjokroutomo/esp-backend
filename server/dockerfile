FROM python:3.10-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    ffmpeg git build-essential && apt-get clean

# Set work directory
WORKDIR /app

# Copy files
COPY . .

# Install Python dependencies (CPU-only PyTorch + Whisper from source)
RUN pip install --no-cache-dir \
    flask \
    requests \
    torch==2.1.2+cpu -f https://download.pytorch.org/whl/torch_stable.html \
    git+https://github.com/openai/whisper.git

# Expose Flask port
EXPOSE 5000

# Run the app
CMD ["python", "server.py"]
